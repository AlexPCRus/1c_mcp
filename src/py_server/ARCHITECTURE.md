# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MCP-–ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Python —á–∞—Å—Ç–∏ MCP-–ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª–µ–π, –∏—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

```
src/py_server/
‚îú‚îÄ‚îÄ __init__.py              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ __main__.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–∞–∫ –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ main.py                  # CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ config.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ onec_client.py           # HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å 1–°
‚îú‚îÄ‚îÄ mcp_server.py            # –û—Å–Ω–æ–≤–Ω–æ–π MCP-—Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–∫—Å–∏ –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ http_server.py           # HTTP-—Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SSE
‚îú‚îÄ‚îÄ stdio_server.py          # Stdio —Å–µ—Ä–≤–µ—Ä –¥–ª—è MCP-–∫–ª–∏–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ test_client.py           # –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
‚îú‚îÄ‚îÄ demo_*.py                # –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ env.example              # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MCP Client    ‚îÇ    ‚îÇ   MCP Client    ‚îÇ    ‚îÇ   Web Client    ‚îÇ
‚îÇ  (Claude, etc)  ‚îÇ    ‚îÇ   (Cursor)      ‚îÇ    ‚îÇ  (Browser)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ stdio                ‚îÇ stdio                ‚îÇ HTTP+SSE
          ‚îÇ                      ‚îÇ                      ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ     MCP Proxy Server    ‚îÇ
                    ‚îÇ    (Python FastAPI)     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚îÇ HTTP
                                 ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ    1C HTTP Service      ‚îÇ
                    ‚îÇ   /hs/mcp/manifest      ‚îÇ
                    ‚îÇ   /hs/mcp/rpc           ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã –ú–æ–¥—É–ª–∏ –∏ –∏—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

### 1. `config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Pydantic
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**
- `Config` - –º–æ–¥–µ–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

**–§—É–Ω–∫—Ü–∏–∏:**
- `get_config()` - —Ñ–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ß–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `MCP_`

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
config = get_config()
print(config.onec_url)  # http://localhost/base
```

### 2. `onec_client.py` - HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è 1–°

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- HTTP-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å 1–°
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ 1–° –∏ MCP
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 1–°

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**
- `OneCClient` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è 1–°

**–ú–µ—Ç–æ–¥—ã:**
- `get_manifest()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –æ—Ç 1–°
- `call_rpc()` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ JSON-RPC –∑–∞–ø—Ä–æ—Å–æ–≤
- `list_tools()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `call_tool()` - –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- `list_resources()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
- `read_resource()` - —á—Ç–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
- `list_prompts()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
- `get_prompt()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MCPProxy` –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –§–æ—Ä–º–∏—Ä—É–µ—Ç URL –ø–æ —Å—Ö–µ–º–µ `/hs/{service_root}/{endpoint}`
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ—Ç–≤–µ—Ç—ã 1–° –≤ —Ç–∏–ø—ã MCP

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
client = OneCClient("http://localhost/base", "user", "pass", "mcp")
tools = await client.list_tools()
result = await client.call_tool("get_customers", {"limit": 10})
```

### 3. `mcp_server.py` - –û—Å–Ω–æ–≤–Ω–æ–π MCP-—Å–µ—Ä–≤–µ—Ä

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ MCP
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É MCP-–∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ 1–°
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**
- `MCPProxy` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å MCP-—Å–µ—Ä–≤–µ—Ä–∞

**–ú–µ—Ç–æ–¥—ã:**
- `_lifespan()` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º
- `_register_handlers()` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ MCP
- `get_capabilities()` - –ø–æ–ª—É—á–µ–Ω–∏–µ capabilities —Å–µ—Ä–≤–µ—Ä–∞
- `get_initialization_options()` - –æ–ø—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ MCP:**
- `handle_list_tools()` - —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `handle_call_tool()` - –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- `handle_list_resources()` - —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—É—Ä—Å–æ–≤
- `handle_read_resource()` - —á—Ç–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞
- `handle_list_prompts()` - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–º–ø—Ç–æ–≤
- `handle_get_prompt()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `OneCClient` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å 1–°
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `MCPHttpServer` –∏ `run_stdio_server`
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç MCP-–∑–∞–ø—Ä–æ—Å—ã –≤ –≤—ã–∑–æ–≤—ã 1–° –∏ –æ–±—Ä–∞—Ç–Ω–æ

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
proxy = MCPProxy(config)
# –°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ MCP
```

### 4. `http_server.py` - HTTP-—Å–µ—Ä–≤–µ—Ä —Å SSE

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- HTTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–æ–≤
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è SSE (Server-Sent Events) —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ CORS –∏ –≤–µ–±-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã:**
- `MCPHttpServer` - HTTP-—Å–µ—Ä–≤–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π MCP

**Endpoints:**
- `GET /` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `GET /sse` - SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è MCP
- `POST /messages` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π MCP

**–ú–µ—Ç–æ–¥—ã:**
- `_register_routes()` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è HTTP –º–∞—Ä—à—Ä—É—Ç–æ–≤
- `handle_sse()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- `handle_messages()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ POST —Å–æ–æ–±—â–µ–Ω–∏–π
- `start()` - –∑–∞–ø—É—Å–∫ HTTP-—Å–µ—Ä–≤–µ—Ä–∞

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `MCPProxy` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ MCP-–∑–∞–ø—Ä–æ—Å–æ–≤
- –£–ø—Ä–∞–≤–ª—è–µ—Ç SSE —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å FastAPI –∏ uvicorn

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
server = MCPHttpServer(config)
await server.start()  # –ó–∞–ø—É—Å–∫ –Ω–∞ http://localhost:8000
```

### 5. `stdio_server.py` - Stdio —Å–µ—Ä–≤–µ—Ä

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è stdio —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –¥–ª—è MCP
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å MCP-–∫–ª–∏–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ stdin/stdout

**–§—É–Ω–∫—Ü–∏–∏:**
- `run_stdio_server()` - –∑–∞–ø—É—Å–∫ stdio —Å–µ—Ä–≤–µ—Ä–∞

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `MCPProxy` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ MCP-–∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MCP-–∫–ª–∏–µ–Ω—Ç–∞–º–∏ —Ç–∏–ø–∞ Claude Desktop, Cursor

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
await run_stdio_server(config)
```

### 6. `main.py` - CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –∑–∞–ø—É—Å–∫

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–æ–º –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§—É–Ω–∫—Ü–∏–∏:**
- `setup_logging()` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `create_parser()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞ CLI
- `main()` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞

**–†–µ–∂–∏–º—ã –∑–∞–ø—É—Å–∫–∞:**
- `stdio` - –¥–ª—è MCP-–∫–ª–∏–µ–Ω—Ç–æ–≤
- `http` - –¥–ª—è –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–æ–≤

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:**
- –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–µ—Ä (`stdio_server` –∏–ª–∏ `http_server`)

```bash
# –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
python -m src.py_server stdio --onec-url http://localhost/base
python -m src.py_server http --port 8000
```

### 7. `test_client.py` - –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 1–°
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã MCP-–ø—Ä–æ–∫—Å–∏
- –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–§—É–Ω–∫—Ü–∏–∏:**
- `test_onec_connection()` - —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 1–°
- `test_mcp_stdio()` - —Ç–µ—Å—Ç MCP —á–µ—Ä–µ–∑ stdio
- `test_http_server()` - —Ç–µ—Å—Ç HTTP-—Å–µ—Ä–≤–µ—Ä–∞

**–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `OneCClient` –¥–ª—è –ø—Ä—è–º–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è 1–°
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç MCP SDK –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∫—Å–∏

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### Stdio —Ä–µ–∂–∏–º (Claude Desktop, Cursor):
```
MCP Client ‚Üí stdin ‚Üí MCPProxy ‚Üí OneCClient ‚Üí 1C HTTP Service
MCP Client ‚Üê stdout ‚Üê MCPProxy ‚Üê OneCClient ‚Üê 1C HTTP Service
```

### HTTP —Ä–µ–∂–∏–º (–≤–µ–±-–∫–ª–∏–µ–Ω—Ç—ã):
```
Web Client ‚Üí HTTP POST ‚Üí MCPHttpServer ‚Üí MCPProxy ‚Üí OneCClient ‚Üí 1C
Web Client ‚Üê SSE ‚Üê MCPHttpServer ‚Üê MCPProxy ‚Üê OneCClient ‚Üê 1C
```

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –∏–º–µ–µ—Ç —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ä–æ–ª—å
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫–æ–≥–µ–∑–∏—è –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª–µ–π

### 2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**
- –í—Å–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

### 3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å**
- –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ì–∏–±–∫–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ MCP
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 5. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- Graceful shutdown

## üîß –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

```
main.py
‚îú‚îÄ‚îÄ config.py
‚îú‚îÄ‚îÄ http_server.py
‚îÇ   ‚îú‚îÄ‚îÄ mcp_server.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ onec_client.py
‚îÇ   ‚îî‚îÄ‚îÄ config.py
‚îî‚îÄ‚îÄ stdio_server.py
    ‚îú‚îÄ‚îÄ mcp_server.py
    ‚îÇ   ‚îî‚îÄ‚îÄ onec_client.py
    ‚îî‚îÄ‚îÄ config.py
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- `DEBUG` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—Ä–æ—Å–∞—Ö/–æ—Ç–≤–µ—Ç–∞—Ö
- `INFO` - —Å–æ–±—ã—Ç–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `WARNING` - –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `ERROR` - –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### Health check:
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 1–°
- –°—Ç–∞—Ç—É—Å—ã: `healthy`, `starting`, `unhealthy`

## üöÄ –¢–æ—á–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### 1. **–ù–æ–≤—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ã**
- WebSocket —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
- gRPC —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
- TCP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç

### 2. **–ù–æ–≤—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞**
- –ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–Ω—Ç
- –í–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–Ω—Ç
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 3. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- OAuth 2.0
- JWT —Ç–æ–∫–µ–Ω—ã
- API –∫–ª—é—á–∏

### 4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –ö—ç—à –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤
- –ö—ç—à —Ä–µ—Å—É—Ä—Å–æ–≤
- –ö—ç—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### 5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- Prometheus –º–µ—Ç—Ä–∏–∫–∏
- Distributed tracing
- Performance monitoring

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –ø—Ä–æ—Å—Ç–æ—Ç—É —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è MCP-–ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞. 